<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Liquidador Maestro Los Olivos & Candelaria</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variables y Modo Oscuro */
        :root {
            --color-primary-olivos: #008f39;
            --color-primary-candelaria: #ff0000;
            --color-dark: #1e293b;
            --color-light: #f8fafc;
            --color-text-dark: #1f2937;
            --color-text-light: #e5e7eb;
            --color-background-main: #f5f8fb;
            --color-background-card: #ffffff;
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-border: #cfd8e6;
            --color-button-base: #12437a;
            --color-header-bg: #fff;
            --color-footer-text: #6b7a8f;
        }

        .dark-mode {
            --color-text-dark: #e5e7eb;
            --color-text-light: #1f2937;
            --color-background-main: #0f172a;
            --color-background-card: #1f2937;
            --color-shadow: rgba(255, 255, 255, 0.08);
            --color-border: #334155;
            --color-button-base: #475569;
            --color-header-bg: #1f2937;
            --color-footer-text: #94a3b8;
        }

        /* Estilos base */
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--color-background-main);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }

        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar/Navegaci√≥n */
        .sidebar {
            width: 280px;
            background: var(--color-header-bg);
            padding: 20px 0;
            box-shadow: 2px 0 5px var(--color-shadow);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .sidebar h2 {
            text-align: center;
            color: var(--color-button-base);
            margin-bottom: 25px;
            font-size: 1.5em;
            font-weight: 700;
            padding: 0 20px;
        }

        .nav-group {
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .nav-group-header {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--color-footer-text);
            padding: 8px 10px;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item {
            display: block;
            width: 100%;
            padding: 10px 15px;
            border: none;
            background: none;
            text-align: left;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, border-radius 0.2s;
            color: var(--color-text-dark);
            border-radius: 6px;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active-olivos {
            background: var(--color-primary-olivos);
            color: white;
            font-weight: 600;
        }

        .nav-item.active-candelaria {
            background: var(--color-primary-candelaria);
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content-wrapper {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: var(--color-background-card);
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--color-shadow);
            min-height: calc(100vh - 80px); /* Ajuste para el wrapper */
        }

        /* Portada Selector */
        h1 { color: var(--color-button-base); text-align: center; margin-bottom: 30px; }
        .selector-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; max-width: 700px; margin: 0 auto; padding-top: 30px; }
        .column-header { font-weight: 700; font-size: 1.3em; text-align: center; margin-bottom: 20px; padding: 10px 0; }
        .header-olivos { color: var(--color-primary-olivos); border-bottom: 3px solid var(--color-primary-olivos); }
        .header-candelaria { color: var(--color-primary-candelaria); border-bottom: 3px solid var(--color-primary-candelaria); }
        .btn-column { display: flex; flex-direction: column; gap: 15px; }

        .btn-main {
            color: #fff;
            border: none;
            padding: 18px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background 0.3s, transform 0.1s, box-shadow 0.3s;
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-candelaria { background: var(--color-primary-candelaria); }
        .btn-candelaria:hover { background: #cc0000; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(255, 0, 0, 0.3); }
        .btn-olivos { background: var(--color-primary-olivos); }
        .btn-olivos:hover { background: #006b2b; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0, 143, 57, 0.3); }

        .footer { text-align: center; margin-top: 40px; color: var(--color-footer-text); font-size: 0.85em; }

        /* Estilos de Liquidadores (manteniendo la estructura original) */
        .card{background:var(--color-background-main);border-radius:8px;padding:18px;margin-bottom:18px;box-shadow:0 1px 6px var(--color-shadow);}
        label{display:block;margin:8px 0 4px;font-weight:600; color: inherit; }
        select,input[type=number]{padding:10px;border:1px solid var(--color-border);background:var(--color-background-card);color:var(--color-text-dark);border-radius:6px;width:200px; transition: border-color 0.2s;}
        select:focus,input[type=number]:focus { border-color: var(--color-button-base); outline: none; }
        .row{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
        .btn{background:var(--color-button-base);color:#fff;border:none;padding:9px 14px;border-radius:6px;cursor:pointer;margin-right:8px; transition: background 0.2s;}
        .btn:hover { background: #0f3a67; }
        .dark-mode .btn:hover { background: #5a6475; }
        table{width:100%;border-collapse:collapse;margin-top:12px; background: var(--color-background-card); border-radius: 8px; overflow: hidden; border: 1px solid var(--color-border);}
        th,td{padding:12px;border:1px solid var(--color-border);text-align:left}
        th{background:var(--color-background-main); font-weight: 700; color: var(--color-button-base);}
        .dark-mode th { background: var(--color-dark); color: var(--color-primary-olivos); }
        .summary{background:var(--color-background-main);padding:15px;border-radius:6px;margin-top:12px; border-left: 5px solid var(--color-primary-olivos); transition: border-color 0.3s;}
        .warning{color:var(--color-primary-candelaria);font-weight:700}
        .small{font-size:0.9em;color:var(--color-footer-text)}
        .muted{color:var(--color-footer-text)}
        .right{text-align:right}
        .btn-back {
            background: var(--color-footer-text);
            color: #fff;
            border: none;
            padding: 9px 14px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-block;
            transition: background 0.2s;
        }
        .btn-back:hover { background: #5a6475; }
        .liquidador-uxs-candelaria select, .liquidador-uxs-candelaria input[type=number],
        .liquidador-uxs-olivos select, .liquidador-uxs-olivos input[type=number] {
            width: 300px;
        }
        .liquidador-cpp-candelaria .summary { border-left-color: var(--color-primary-candelaria); }
        .liquidador-cpp-olivos .summary { border-left-color: var(--color-primary-olivos); }

        /* Floating Copy Button */
        .btn-copy-float {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: var(--color-primary-olivos);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            border: none;
            display: none; /* Se oculta por defecto y se muestra en los liquidadores */
            transition: background 0.2s, transform 0.1s;
            z-index: 1000;
        }
        .btn-copy-float:hover {
            background: #006b2b;
            transform: translateY(-1px);
        }
        .dark-mode .btn-copy-float {
             background: var(--color-primary-olivos);
        }
        .liquidador-cpp-candelaria .btn-copy-float,
        .liquidador-pap-candelaria .btn-copy-float,
        .liquidador-uxs-candelaria .btn-copy-float {
            background: var(--color-primary-candelaria);
        }
        .liquidador-cpp-candelaria .btn-copy-float:hover,
        .liquidador-pap-candelaria .btn-copy-float:hover,
        .liquidador-uxs-candelaria .btn-copy-float:hover {
            background: #cc0000;
        }

        /* Dark Mode Toggle */
        .mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--color-background-card);
            border: 1px solid var(--color-border);
            color: var(--color-text-dark);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            z-index: 1001;
            box-shadow: 0 2px 4px var(--color-shadow);
        }
        .dark-mode .mode-toggle {
            color: var(--color-text-dark);
        }
        
        /* Media Queries */
        @media (max-width: 900px) {
            .app-layout { flex-direction: column; }
            .sidebar { width: 100%; max-height: 200px; box-shadow: 0 2px 5px var(--color-shadow); }
            .main-content-wrapper { padding: 20px; }
            .container { padding: 10px; min-height: auto; }
            .selector-grid { grid-template-columns: 1fr; max-width: 400px; gap: 20px; }
            .btn-copy-float { bottom: 15px; right: 15px; padding: 12px 18px; font-size: 0.9em; }
            .mode-toggle { top: 10px; right: 10px; }
        }
        @media (max-width: 680px) {
             .sidebar { max-height: 150px; }
        }
    </style>
    <script>
        // Funciones Comunes Globales
        function $(id){ return document.getElementById(id) }
        function formatMoney(n){ return new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0}).format(Math.round(n)); }
    </script>
</head>
<body id="body-main">

    <button id="modeToggle" class="mode-toggle">‚òÄÔ∏è Modo Claro</button>

    <div class="app-layout">
        
        <div class="sidebar" id="sidebar">
            <h2>Liquidador Maestro</h2>

            <div class="nav-group">
                <button class="nav-item" onclick="loadSelector()">‚Üê Volver al Portal Principal</button>
            </div>
            
            <div class="nav-group">
                <div class="nav-group-header" style="color: var(--color-primary-olivos);">üíö Los Olivos</div>
                <button class="nav-item" id="nav-cpp-olivos" onclick="loadCPP_Olivos()">CPP Los Olivos</button>
                <button class="nav-item" id="nav-pap-olivos" onclick="loadPAP_Olivos()">PAP Los Olivos</button>
                <button class="nav-item" id="nav-uxs-olivos" onclick="loadUXS_Olivos()">UXS Los Olivos</button>
            </div>

            <div class="nav-group">
                <div class="nav-group-header" style="color: var(--color-primary-candelaria);">üî¥ La Candelaria</div>
                <button class="nav-item" id="nav-cpp-candelaria" onclick="loadCPP_Candelaria()">CPP La Candelaria</button>
                <button class="nav-item" id="nav-pap-candelaria" onclick="loadPAP_Candelaria()">PAP La Candelaria</button>
                <button class="nav-item" id="nav-uxs-candelaria" onclick="loadUXS_Candelaria()">UXS La Candelaria</button>
            </div>
        </div>

        <div class="main-content-wrapper">
             <div id="main-content">
                </div>
        </div>
    </div>
    
    <button class="btn-copy-float" id="btnCopyFloat" style="display: none;" onclick="window._currentCopyFunction && window._currentCopyFunction()">
        üìã Copiar Resumen
    </button>


    <script>
        
        // --- Dark Mode Logic ---
        const body = $('body-main');
        const modeToggle = $('modeToggle');
        function toggleDarkMode() {
            body.classList.toggle('dark-mode');
            const isDarkMode = body.classList.contains('dark-mode');
            modeToggle.textContent = isDarkMode ? 'üåô Modo Oscuro' : '‚òÄÔ∏è Modo Claro';
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
        }

        if (localStorage.getItem('darkMode') === 'enabled') {
            body.classList.add('dark-mode');
            modeToggle.textContent = 'üåô Modo Oscuro';
        }

        modeToggle.addEventListener('click', toggleDarkMode);

        // --- Navigation and Load Functions ---
        const navItems = document.querySelectorAll('.nav-item');
        function setActiveNav(id) {
            navItems.forEach(item => {
                item.classList.remove('active-olivos', 'active-candelaria');
            });
            if (id) {
                const item = $(id);
                if (item) {
                    item.classList.add(id.includes('candelaria') ? 'active-candelaria' : 'active-olivos');
                }
            }
        }

        // Funci√≥n para cargar la interfaz de selecci√≥n
        function loadSelector() {
            document.title = 'Portal de Cotizaciones';
            document.getElementById('body-main').className = '';
            $('btnCopyFloat').style.display = 'none';
            window._currentCopyFunction = null;
            setActiveNav(null);

            document.getElementById('main-content').innerHTML = `
                <div class="container">
                    <h1>Portal de Cotizaciones - Los Olivos & La Candelaria</h1>
                    
                    <div class="selector-grid">
                        
                        <div class="column-olivos">
                            <div class="column-header header-olivos">LOS OLIVOS</div>
                            <div class="btn-column">
                                <button class="btn-main btn-olivos" onclick="loadCPP_Olivos()">CPP Los Olivos</button>
                                <button class="btn-main btn-olivos" onclick="loadPAP_Olivos()">PAP Los Olivos</button>
                                <button class="btn-main btn-olivos" onclick="loadUXS_Olivos()">UXS Los Olivos</button>
                            </div>
                        </div>

                        <div class="column-candelaria">
                            <div class="column-header header-candelaria">LA CANDELARIA</div>
                            <div class="btn-column">
                                <button class="btn-main btn-candelaria" onclick="loadCPP_Candelaria()">CPP La Candelaria</button>
                                <button class="btn-main btn-candelaria" onclick="loadPAP_Candelaria()">PAP La Candelaria</button>
                                <button class="btn-main btn-candelaria" onclick="loadUXS_Candelaria()">UXS La Candelaria</button>
                            </div>
                        </div>

                    </div>

                    <div class="footer">
                        Asistente Comercial Integral | Tarifas 2025‚Äì2026
                    </div>
                </div>
            `;
        }


        // Funci√≥n para inyectar el contenido y el script del liquidador (L√≥gica Original Mantenida)
        function loadLiquidador(htmlContent, className, scriptContent, title, navId) {
            document.title = title;
            document.getElementById('body-main').className = className;
            $('btnCopyFloat').style.display = 'block';
            setActiveNav(navId);

            // Primero, inyectar el HTML (sin el bot√≥n de regreso, que ahora es el sidebar/nav).
            document.getElementById('main-content').innerHTML = `
                <div class="container ${className}">
                    <button class="btn-back" onclick="loadSelector()">‚Üê Volver a la Selecci√≥n de Liquidadores</button>
                    <div id="liquidador-area">
                    ${htmlContent}
                    </div>
                </div>
            `;
            
            // Re-vincular el evento del bot√≥n flotante y el interno.
            // Para mantener la l√≥gica original de `btnCopy` y el script, inyectamos primero y luego
            // establecemos la funci√≥n de copia global.
            window._currentCopyFunction = null;

            // Luego, ejecutar el script. El script DEBE contener la funci√≥n initUI() y calculate().
            try {
                // Envuelve el script en una funci√≥n an√≥nima para aislar el scope y mantener variables locales.
                // Se usa eval para ejecutar el script como si estuviera en un <script> tag nuevo.
                (function() {
                    // Exportamos la funci√≥n de c√°lculo y la de copiado del script para poder llamarlas
                    // desde los botones globales.
                    window._currentScriptContent = scriptContent;
                    eval(scriptContent); 
                })();

                // Re-mapear el bot√≥n flotante y el bot√≥n interno a la misma l√≥gica de copiado.
                // Asumimos que la l√≥gica de copiado est√° definida en el script como parte de initUI/listeners.
                // Esto es una adaptaci√≥n forzada al dise√±o SPA, manteniendo la l√≥gica original de la app.
                // La l√≥gica de copiado est√° en los scripts originales a trav√©s del listener de 'btnCopy'.
                // Debemos extraer esa funci√≥n y asociarla al bot√≥n flotante.
                // Dado que no podemos modificar los scripts originales, nos basaremos en el listener de 'btnCopy'.
                
                const btnCopy = $('btnCopy');
                if(btnCopy) {
                    // Reasignamos la funci√≥n de clic para que el bot√≥n flotante la use.
                    window._currentCopyFunction = btnCopy.onclick || (() => {
                        // Simular el clic del bot√≥n interno si no podemos acceder a su funci√≥n.
                        btnCopy.click();
                    });
                    
                    // Aseguramos que el bot√≥n interno y flotante hagan lo mismo.
                    btnCopy.addEventListener('click', () => {
                        window._currentCopyFunction();
                    });
                    
                    // Ocultar el bot√≥n de copiado interno para forzar el uso del flotante (mejor UX)
                    btnCopy.style.display = 'none'; 
                    // Y reasignar el listener del flotante
                    $('btnCopyFloat').onclick = window._currentCopyFunction; 
                }
                
                // Ejecutar c√°lculo inicial para que la tabla no est√© vac√≠a.
                if(window.calculate && btnCopy) {
                    window.calculate(); 
                }

            } catch (e) {
                console.error("Error al ejecutar el script del liquidador:", e);
                document.getElementById('liquidador-area').innerHTML = '<div class="warning">Hubo un error al cargar la calculadora. Por favor, revisa la consola para m√°s detalles.</div>';
            }
        }

        // --- DEFINICIONES DE CONTENIDO Y SCRIPTS (ORIGINALES E ID√âNTICOS) ---
        
        // ** (Aqu√≠ se insertar√≠a TODO el c√≥digo JavaScript y las constantes HTML/Script del archivo original) **
        
        // 1. CPP La Candelaria (FRAGMENTO CORREGIDO)
        const CPP_Candelaria_HTML = `
            <h1>Liquidador CPP ‚Äî Candelaria (Abril 2025 ‚Äì Marzo 2026)</h1>
            <div class="card">
                <div class="small muted">Datos del plan</div>
                <div class="row" style="margin-top:6px">
                    <div><label>Selecciona el Plan CPP</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                    <div><label>N√∫mero de adultos mayores (&gt;70 a√±os)</label><input id="numMayores" type="number" min="0" max="2" value="0" /></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div style="margin-top:8px">
                    <label>Bicicleta (cantidad)</label><input id="as_bici" type="number" min="0" max="10" value="0"/>
                    <label>Mascota (cantidad)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/>
                    <label>Repatriaci√≥n (cantidad)</label><input id="as_repat" type="number" min="0" max="10" value="0"/>
                    <label>Salud (cantidad)</label><input id="as_salud" type="number" min="0" max="10" value="0"/>
                    <label>Seguro (cantidad)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual sin descuento</th><th class="right">Anual con descuento (1er a√±o)</th><th class="right">Cuota (si aplica)</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textMayores" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const CPP_Candelaria_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"CPP1", cupos:1, cuotasPermitidas:[1,2,4,6],
                        values: {
                            "1": { annual_no_discount:163250, annual_with_discount:149646 },
                            "2": { annual_no_discount:186100, annual_with_discount:170592 },
                            "4": { annual_no_discount:186100, annual_with_discount:170592 },
                            "6": { annual_no_discount:186100, annual_with_discount:170592 }
                        }
                    },
                    "2": { name:"CPP2", cupos:2, cuotasPermitidas:[1,2,4,6,8],
                        values: {
                            "1": { annual_no_discount:293800, annual_with_discount:269317 },
                            "2": { annual_no_discount:334900, annual_with_discount:306992 },
                            "4": { annual_no_discount:334900, annual_with_discount:306992 },
                            "6": { annual_no_discount:334900, annual_with_discount:306992 },
                            "8": { annual_no_discount:334900, annual_with_discount:306992 }
                        }
                    },
                    "3": { name:"CPP3", cupos:3, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:391800, annual_with_discount:359150 },
                            "2": { annual_no_discount:446700, annual_with_discount:409475 },
                            "3": { annual_no_discount:446700, annual_with_discount:409475 },
                            "4": { annual_no_discount:446700, annual_with_discount:409475 },
                            "6": { annual_no_discount:446700, annual_with_discount:409475 },
                            "8": { annual_no_discount:446700, annual_with_discount:409475 },
                            "10":{ annual_no_discount:446700, annual_with_discount:409475 }
                        }
                    },
                    "4": { name:"CPP4", cupos:4, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:456800, annual_with_discount:418733 },
                            "2": { annual_no_discount:520800, annual_with_discount:477400 },
                            "3": { annual_no_discount:520800, annual_with_discount:477400 },
                            "4": { annual_no_discount:520800, annual_with_discount:477400 },
                            "6": { annual_no_discount:520800, annual_with_discount:477400 },
                            "8": { annual_no_discount:520800, annual_with_discount:477400 },
                            "10":{ annual_no_discount:520800, annual_with_discount:477400 }
                        }
                    },
                    "5": { name:"CPP5", cupos:5, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:489500, annual_with_discount:448708 },
                            "2": { annual_no_discount:558000, annual_with_discount:511500 },
                            "3": { annual_no_discount:558000, annual_with_discount:511500 },
                            "4": { annual_no_discount:558000, annual_with_discount:511500 },
                            "6": { annual_no_discount:558000, annual_with_discount:511500 },
                            "8": { annual_no_discount:558000, annual_with_discount:511500 },
                            "10":{ annual_no_discount:558000, annual_with_discount:511500 }
                        }
                    },
                    "10": { name:"CPP10", cupos:10, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:691000, annual_with_discount:633417 },
                            "2": { annual_no_discount:787700, annual_with_discount:722059 },
                            "3": { annual_no_discount:787700, annual_with_discount:722059 },
                            "4": { annual_no_discount:787700, annual_with_discount:722059 },
                            "6": { annual_no_discount:787700, annual_with_discount:722059 },
                            "8": { annual_no_discount:787700, annual_with_discount:722059 },
                            "10":{ annual_no_discount:787700, annual_with_discount:722059 }
                        }
                    }
                },
                mayores: {
                    "1": { annual_no_discount:217200, annual_with_discount:199100 },
                    "2": { annual_no_discount:250800, annual_with_discount:229900 },
                    "3": { annual_no_discount:250800, annual_with_discount:229900 },
                    "4": { annual_no_discount:250800, annual_with_discount:229900 },
                    "6": { annual_no_discount:250800, annual_with_discount:229900 },
                    "8": { annual_no_discount:250800, annual_with_discount:229900 },
                    "10":{ annual_no_discount:250800, annual_with_discount:229900 }
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO DE SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de CPP_Candelaria (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const nMay = Math.max(0, Math.min(2, parseInt($('numMayores').value||0,10)));
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, parseInt($('as_seguro').value||0,10)); 

            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;
            const plan_anual_primer = planVals.annual_with_discount;

            const mayorVals = window.data.mayores[String(cuotas)] || window.data.mayores["2"];
            const mayor_anual_renov = mayorVals.annual_no_discount;
            const mayor_anual_primer = mayorVals.annual_with_discount;

            function assistValue(type, qty){
                if(qty<=0) return {anual_renov:0, anual_primer:0};
                const vals = window.data.assists[type].values[String(cuotas)] || window.data.assists[type].values["1"];
                const anual_renov = vals.annual_no_discount * qty;
                const anual_primer = vals.annual_with_discount * qty;
                return {anual_renov,anual_primer};
            }

            const as_b = assistValue('bici', qty_bici);
            const as_m = assistValue('mascota', qty_masc);
            const as_r = assistValue('repatriacion', qty_rep);
            const as_s = assistValue('salud', qty_sal);
            const as_se = assistValue('seguro', qty_seg); 

            let final_plan_cost_renov = 0;
            let final_plan_cost_primer = 0;
            let table_plan_row_renov = plan_anual_renov;
            let table_plan_row_primer = plan_anual_primer;
            let detalleAdultosRenov = 0;
            let detalleAdultos = 0;

            if(nMay > 0 && planId==="10"){
                detalleAdultosRenov = mayor_anual_renov * nMay;
                detalleAdultos = mayor_anual_primer * nMay;
                final_plan_cost_renov = plan_anual_renov + detalleAdultosRenov;
                final_plan_cost_primer = plan_anual_primer + detalleAdultos;
                table_plan_row_renov = plan_anual_renov;
                table_plan_row_primer = plan_anual_primer;
            } else if (nMay > 0 && ['2','3','4','5'].includes(planId)) {
                const baseCupos = plan.cupos;
                const per_person_renov = plan_anual_renov / baseCupos;
                const per_person_primer = plan_anual_primer / baseCupos;
                const ocupadosPorMenores = Math.max(0, baseCupos - nMay);
                
                final_plan_cost_renov = per_person_renov * ocupadosPorMenores + mayor_anual_renov * nMay;
                final_plan_cost_primer = per_person_primer * ocupadosPorMenores + mayor_anual_primer * nMay;
                table_plan_row_renov = final_plan_cost_renov;
                table_plan_row_primer = final_plan_cost_primer;
                
                detalleAdultosRenov = mayor_anual_renov * nMay; 
                detalleAdultos = mayor_anual_primer * nMay;
            } else {
                final_plan_cost_renov = plan_anual_renov;
                final_plan_cost_primer = plan_anual_primer;
                table_plan_row_renov = plan_anual_renov;
                table_plan_row_primer = plan_anual_primer;
            }

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;
            const assists_primer_total = as_b.anual_primer + as_m.anual_primer + as_r.anual_primer + as_s.anual_primer + as_se.anual_primer;

            const total_renov = final_plan_cost_renov + assists_renov_total;
            const total_primer = final_plan_cost_primer + assists_primer_total;

            const cuota_primer = total_primer / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            function addRow(label, valRenov, valPrimer, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = formatMoney(valPrimer);
                const td4 = document.createElement('td'); td4.className='right'; td4.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
                tbody.appendChild(tr);
            }

            const planLabel = (planId==="10" && nMay>0) ? \`\${window.data.plans[planId].name} (Plan Base 10 cupos)\` : \`\${window.data.plans[planId].name} (Plan Ajustado)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_primer, table_plan_row_primer / (cuotas>0?cuotas:1));

            if(nMay>0){
                const detalleCuota = detalleAdultos / (cuotas>0?cuotas:1);
                addRow(\`Adicional/Adultos mayores (\${nMay})\`, detalleAdultosRenov, detalleAdultos, detalleCuota);
            }

            if(qty_bici>0) addRow(\`\${window.data.assists.bici.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_primer, as_b.anual_primer/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`\${window.data.assists.mascota.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_primer, as_m.anual_primer/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`\${window.data.assists.repatriacion.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_primer, as_r.anual_primer/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`\${window.data.assists.salud.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_primer, as_s.anual_primer/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`\${window.data.assists.seguro.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_primer, as_se.anual_primer/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(total_primer)}</th><th class="right">\${formatMoney(cuota_primer)}</th>\`;
            foot.appendChild(trT);

            $('textPlan').textContent = \`Cliente, el plan \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor total anual de \${formatMoney(total_renov)}, y el primer a√±o con descuento ser√° de \${formatMoney(total_primer)}. Carencia 60 d√≠as.\`;
            if(nMay>0){
                $('textMayores').textContent = \`Recuerde que tiene \${nMay} adicional(es) de adulto mayor con un valor anual total de \${formatMoney(detalleAdultosRenov)} (renovaci√≥n) y \${formatMoney(detalleAdultos)} (primer a√±o).\`;
            } else {
                $('textMayores').textContent = '';
            }
            $('textTotal').textContent = \`El total a pagar mensualmente, incluyendo las asistencias (si las hay), ser√° de \${formatMoney(cuota_primer)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, total_primer, cuota_primer,
                detalleAdultosRenov, detalleAdultos,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();
            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='5'; window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('numMayores').value='0';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0';
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; $('textPlan').textContent=''; $('textMayores').textContent=''; $('textTotal').textContent='';
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n:\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual (renovaci√≥n): \${formatMoney(s.total_renov)}\\nTotal anual (primer a√±o con descuento): \${formatMoney(s.total_primer)}\\nCuota por mes (primer a√±o): \${formatMoney(s.cuota_primer)}\\n\`;
                if(s.detalleAdultos>0) txt += \`Adicional adultos (primer a√±o): \${formatMoney(s.detalleAdultos)}\\n\`;
                const a = s.assists; txt += \`Asistencias: bici x\${a.bici}, mascota x\${a.mascota}, repat x\${a.repat}, salud x\${a.salud}, seguro x\${a.seguro}\n\`; 
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate();
        }
        window.initUI();
        `;
        function loadCPP_Candelaria() {
            loadLiquidador(CPP_Candelaria_HTML, 'liquidador-cpp-candelaria', CPP_Candelaria_Script, 'Liquidador CPP ‚Äî Candelaria', 'nav-cpp-candelaria');
        }

        // 2. CPP Los Olivos
        const CPP_Olivos_HTML = `
            <h1>Liquidador CPP ‚Äî Los Olivos (Abril 2025 ‚Äì Marzo 2026)</h1>
            <div class="card">
                <div class="small muted">Datos del plan</div>
                <div class="row" style="margin-top:6px">
                    <div><label>Selecciona el Plan CPP</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                    <div><label>N√∫mero de adultos mayores (&gt;70 a√±os)</label><input id="numMayores" type="number" min="0" max="2" value="0" /></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div style="margin-top:8px">
                     <div class="input-group"><label>Bicicleta (cantidad)</label><input id="as_bici" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Mascota (cantidad)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/></div>
                    <div class="input-group"><label>Repatriaci√≥n (cantidad)</label><input id="as_repat" type="number" min="0" max="10" value="0"/>
                    <div class="input-group"><label>Salud (cantidad)</label><input id="as_salud" type="number" min="0" max="10" value="0"/>
                    <div class="input-group"><label>Seguro (cantidad)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual sin descuento</th><th class="right">Anual con descuento (1er a√±o)</th><th class="right">Cuota (si aplica)</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textMayores" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const CPP_Olivos_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"CPP1", cupos:1, cuotasPermitidas:[1,2,4,6],
                        values: {
                            "1": { annual_no_discount:73850, annual_with_discount:67696 },
                            "2": { annual_no_discount:84200, annual_with_discount:77183 },
                            "4": { annual_no_discount:84200, annual_with_discount:77183 },
                            "6": { annual_no_discount:84200, annual_with_discount:77183 }
                        }
                    },
                    "2": { name:"CPP2", cupos:2, cuotasPermitidas:[1,2,4,6,8],
                        values: {
                            "1": { annual_no_discount:133000, annual_with_discount:121917 },
                            "2": { annual_no_discount:151600, annual_with_discount:138967 },
                            "4": { annual_no_discount:151600, annual_with_discount:138967 },
                            "6": { annual_no_discount:151600, annual_with_discount:138967 },
                            "8": { annual_no_discount:151600, annual_with_discount:138967 }
                        }
                    },
                    "3": { name:"CPP3", cupos:3, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:177000, annual_with_discount:162250 },
                            "2": { annual_no_discount:201800, annual_with_discount:184983 },
                            "3": { annual_no_discount:201800, annual_with_discount:184983 },
                            "4": { annual_no_discount:201800, annual_with_discount:184983 },
                            "6": { annual_no_discount:201800, annual_with_discount:184983 },
                            "8": { annual_no_discount:201800, annual_with_discount:184983 },
                            "10":{ annual_no_discount:201800, annual_with_discount:184983 }
                        }
                    },
                    "4": { name:"CPP4", cupos:4, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:206800, annual_with_discount:189567 },
                            "2": { annual_no_discount:235800, annual_with_discount:216150 },
                            "3": { annual_no_discount:235800, annual_with_discount:216150 },
                            "4": { annual_no_discount:235800, annual_with_discount:216150 },
                            "6": { annual_no_discount:235800, annual_with_discount:216150 },
                            "8": { annual_no_discount:235800, annual_with_discount:216150 },
                            "10":{ annual_no_discount:235800, annual_with_discount:216150 }
                        }
                    },
                    "5": { name:"CPP5", cupos:5, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:221500, annual_with_discount:203042 },
                            "2": { annual_no_discount:252500, annual_with_discount:231458 },
                            "3": { annual_no_discount:252500, annual_with_discount:231458 },
                            "4": { annual_no_discount:252500, annual_with_discount:231458 },
                            "6": { annual_no_discount:252500, annual_with_discount:231458 },
                            "8": { annual_no_discount:252500, annual_with_discount:231458 },
                            "10":{ annual_no_discount:252500, annual_with_discount:231458 }
                        }
                    },
                    "10": { name:"CPP10", cupos:10, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:312600, annual_with_discount:286550 },
                            "2": { annual_no_discount:356400, annual_with_discount:326700 },
                            "3": { annual_no_discount:356400, annual_with_discount:326700 },
                            "4": { annual_no_discount:356400, annual_with_discount:326700 },
                            "6": { annual_no_discount:356400, annual_with_discount:326700 },
                            "8": { annual_no_discount:356400, annual_with_discount:326700 },
                            "10":{ annual_no_discount:356400, annual_with_discount:326700 }
                        }
                    }
                },
                mayores: {
                    "1": { annual_no_discount:163200, annual_with_discount:149600 },
                    "2": { annual_no_discount:188840, annual_with_discount:173103 },
                    "3": { annual_no_discount:188840, annual_with_discount:173103 },
                    "4": { annual_no_discount:188840, annual_with_discount:173103 },
                    "6": { annual_no_discount:188840, annual_with_discount:173103 },
                    "8": { annual_no_discount:188840, annual_with_discount:173103 },
                    "10":{ annual_no_discount:188840, annual_with_discount:173103 }
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO: SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de CPP_Olivos (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const nMay = Math.max(0, Math.min(2, parseInt($('numMayores').value||0,10)));
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, Math.min(1, parseInt($('as_seguro').value||0,10))); 

            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;
            const plan_anual_primer = planVals.annual_with_discount;

            const mayorVals = window.data.mayores[String(cuotas)] || window.data.mayores["2"];
            const mayor_anual_renov = mayorVals.annual_no_discount;
            const mayor_anual_primer = mayorVals.annual_with_discount;

            function assistValue(type, qty){
                if(qty<=0) return {anual_renov:0, anual_primer:0};
                const key = type === 'seguro' ? 'seguro' : type; 
                const vals = window.data.assists[key].values[String(cuotas)] || window.data.assists[key].values["1"];
                const anual_renov = vals.annual_no_discount * qty;
                const anual_primer = vals.annual_with_discount * qty;
                return {anual_renov,anual_primer};
            }

            const as_b = assistValue('bici', qty_bici);
            const as_m = assistValue('mascota', qty_masc);
            const as_r = assistValue('repatriacion', qty_rep);
            const as_s = assistValue('salud', qty_sal);
            const as_se = assistValue('seguro', qty_seg); 

            let final_plan_cost_renov = 0;
            let final_plan_cost_primer = 0;
            let table_plan_row_renov = plan_anual_renov;
            let table_plan_row_primer = plan_anual_primer;
            let detalleAdultosRenov = 0;
            let detalleAdultos = 0;

            if(nMay > 0 && planId==="10"){
                detalleAdultosRenov = mayor_anual_renov * nMay;
                detalleAdultos = mayor_anual_primer * nMay;
                final_plan_cost_renov = plan_anual_renov + detalleAdultosRenov;
                final_plan_cost_primer = plan_anual_primer + detalleAdultos;
                table_plan_row_renov = plan_anual_renov;
                table_plan_row_primer = plan_anual_primer;
            } else if (nMay > 0 && ['2','3','4','5'].includes(planId)) {
                const baseCupos = plan.cupos;
                const per_person_renov = plan_anual_renov / baseCupos;
                const per_person_primer = plan_anual_primer / baseCupos;
                const ocupadosPorMenores = Math.max(0, baseCupos - nMay);
                
                final_plan_cost_renov = per_person_renov * ocupadosPorMenores + mayor_anual_renov * nMay;
                final_plan_cost_primer = per_person_primer * ocupadosPorMenores + mayor_anual_primer * nMay;
                table_plan_row_renov = final_plan_cost_renov;
                table_plan_row_primer = final_plan_cost_primer;
                
                detalleAdultosRenov = mayor_anual_renov * nMay; 
                detalleAdultos = mayor_anual_primer * nMay;
            } else {
                final_plan_cost_renov = plan_anual_renov;
                final_plan_cost_primer = plan_anual_primer;
                table_plan_row_renov = plan_anual_renov;
                table_plan_row_primer = plan_anual_primer;
            }

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;
            const assists_primer_total = as_b.anual_primer + as_m.anual_primer + as_r.anual_primer + as_s.anual_primer + as_se.anual_primer;
            
            const total_renov = final_plan_cost_renov + assists_renov_total;
            const total_primer = final_plan_cost_primer + assists_primer_total;

            const cuota_primer = total_primer / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            function addRow(label, valRenov, valPrimer, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = formatMoney(valPrimer);
                const td4 = document.createElement('td'); td4.className='right'; td4.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
                tbody.appendChild(tr);
            }

            const planLabel = (planId==="10" && nMay>0) ? \`\${window.data.plans[planId].name} (Plan Base 10 cupos)\` : \`\${window.data.plans[planId].name} (Plan Ajustado)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_primer, table_plan_row_primer / (cuotas>0?cuotas:1));

            if(nMay>0){
                const detalleCuota = detalleAdultos / (cuotas>0?cuotas:1);
                addRow(\`Adicional/Adultos mayores (\${nMay})\`, detalleAdultosRenov, detalleAdultos, detalleCuota);
            }

            if(qty_bici>0) addRow(\`\${window.data.assists.bici.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_primer, as_b.anual_primer/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`\${window.data.assists.mascota.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_primer, as_m.anual_primer/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`\${window.data.assists.repatriacion.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_primer, as_r.anual_primer/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`\${window.data.assists.salud.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_primer, as_s.anual_primer/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`\${window.data.assists.seguro.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_primer, as_se.anual_primer/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(total_primer)}</th><th class="right">\${formatMoney(cuota_primer)}</th>\`;
            foot.appendChild(trT);

            $('textPlan').textContent = \`Cliente, el plan \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor total anual de \${formatMoney(total_renov)}, y el primer a√±o con descuento ser√° de \${formatMoney(total_primer)}. Carencia 60 d√≠as.\`;
            if(nMay>0){
                $('textMayores').textContent = \`Recuerde que tiene \${nMay} adicional(es) de adulto mayor con un valor anual total de \${formatMoney(detalleAdultosRenov)} (renovaci√≥n) y \${formatMoney(detalleAdultos)} (primer a√±o).\`;
            } else {
                $('textMayores').textContent = '';
            }
            $('textTotal').textContent = \`El total a pagar mensualmente, incluyendo las asistencias (si las hay), ser√° de \${formatMoney(cuota_primer)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, total_primer, cuota_primer,
                detalleAdultosRenov, detalleAdultos,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();

            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='5'; window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('numMayores').value='0';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0'; 
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; $('textPlan').textContent=''; $('textMayores').textContent=''; $('textTotal').textContent='';
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n:\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual (renovaci√≥n): \${formatMoney(s.total_renov)}\\nTotal anual (primer a√±o con descuento): \${formatMoney(s.total_primer)}\\nCuota por mes (primer a√±o): \${formatMoney(s.cuota_primer)}\\n\`;
                if(s.detalleAdultos>0) txt += \`Adicional adultos (primer a√±o): \${formatMoney(s.detalleAdultos)}\\n\`;
                const a = s.assists; txt += \`Asistencias: bici x\${a.bici}, mascota x\${a.mascota}, repat x\${a.repat}, salud x\${a.salud}, seguro x\${a.seguro}\\n\`; 
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate(); 
        }
        window.initUI();
        `;
        function loadCPP_Olivos() {
            loadLiquidador(CPP_Olivos_HTML, 'liquidador-cpp-olivos', CPP_Olivos_Script, 'Liquidador CPP ‚Äî Los Olivos', 'nav-cpp-olivos');
        }

       // 3. PAP La Candelaria
        const PAP_Candelaria_HTML = `
            <h1>Liquidador PAP ‚Äî La Candelaria (Planes y Asistencias)</h1>
            <div class="card">
                <div class="small muted">Datos base del plan</div>
                <div class="row" style="margin-top:6px; margin-bottom: 15px;">
                    <div><label>Selecciona el Plan PAP</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div class="row" style="margin-top:8px">
                    <div class="input-group"><label>Bicicleta (cant.)</label><input id="as_bici" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Mascota (cant.)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/></div>
                    <div class="input-group"><label>Repatriaci√≥n (cant.)</label><input id="as_repat" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Salud (cant.)</label><input id="as_salud" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Seguro (cant.)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/></div>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo (Tarifa de Renovaci√≥n)</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textAsistencias" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const PAP_Candelaria_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"UNO CANDELARIA", cupos:1, cuotasPermitidas:[1,2],
                        values: {
                            "1": { annual_no_discount:163250 },
                            "2": { annual_no_discount:197600 },
                        }
                    },
                    "2": { name:"UNIDOS CANDELARIA", cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:510400 },
                            "2": { annual_no_discount:628200 },
                            "4": { annual_no_discount:628200 },
                            "6": { annual_no_discount:628200 },
                            "8": { annual_no_discount:628200 },
                            "10":{ annual_no_discount:628200 }
                        }
                    },
                },
                mayores: {
                    "1": { annual_no_discount:163200, annual_with_discount:149600 },
                    "2": { annual_no_discount:188840, annual_with_discount:173103 },
                    "10":{ annual_no_discount:188840, annual_with_discount:173103 }
                },
                adicionales: {
                    adulto: { label:"Adulto (18-69)", values: { "1": { annual_no_discount:73850 } }},
                    menor: { label:"Menor (<18)", values: { "1": { annual_no_discount:51950 } }}
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO: SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de PAP_Candelaria (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, parseInt($('as_seguro').value||0,10)); 
            
            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;

            function getAdicionalValue(type, qty){
                if(qty<=0) return {label:'', anual_renov:0};
                let vals = window.data.assists[type].values[String(cuotas)] || window.data.assists[type].values["1"];
                let label = \`\${window.data.assists[type].label}\`;
                const anual_renov = vals.annual_no_discount * qty;
                return {label, anual_renov};
            }

            const as_b = getAdicionalValue('bici', qty_bici);
            const as_m = getAdicionalValue('mascota', qty_masc);
            const as_r = getAdicionalValue('repatriacion', qty_rep);
            const as_s = getAdicionalValue('salud', qty_sal);
            const as_se = getAdicionalValue('seguro', qty_seg); 
            
            const final_plan_cost_renov = plan_anual_renov;
            const table_plan_row_renov = plan_anual_renov;

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;

            const total_renov = final_plan_cost_renov + assists_renov_total;

            const cuota_renov = total_renov / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            
            function addRow(label, valRenov, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
                tbody.appendChild(tr);
            }

            $('resultTable').querySelector('thead tr').innerHTML = '<th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th>';
            const planLabel = \`\${window.data.plans[planId].name} (Plan Base)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_renov / (cuotas>0?cuotas:1));

            if(qty_bici>0) addRow(\`Asistencia \${as_b.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_renov/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`Asistencia \${as_m.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_renov/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`Asistencia \${as_r.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_renov/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`Asistencia \${as_s.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_renov/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`Asistencia \${as_se.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_renov/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total de Renovaci√≥n</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(cuota_renov)}</th>\`;
            foot.appendChild(trT);

            $('textsArea').innerHTML = '';
            const divPlan = document.createElement('div'); divPlan.id = 'textPlan'; $('textsArea').appendChild(divPlan);
            const divAsist = document.createElement('div'); divAsist.id = 'textAsistencias'; divAsist.style.marginTop = '6px'; $('textsArea').appendChild(divAsist);
            const divTotal = document.createElement('div'); divTotal.id = 'textTotal'; divTotal.style.marginTop = '6px'; $('textsArea').appendChild(divTotal);

            $('textPlan').textContent = \`Estimado Cliente, el plan \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor base anual de \${formatMoney(plan_anual_renov)} para la renovaci√≥n.\`;
            
            let assist_text = [];
            if (qty_bici > 0) assist_text.push(\`\${qty_bici} Bicicleta\`);
            if (qty_masc > 0) assist_text.push(\`\${qty_masc} Mascota\`);
            if (qty_rep > 0) assist_text.push(\`\${qty_rep} Repatriaci√≥n\`);
            if (qty_sal > 0) assist_text.push(\`\${qty_sal} Salud\`);
            if (qty_seg > 0) assist_text.push(\`\${qty_seg} Seguro\`); 

            if(assists_renov_total > 0) {
                $('textAsistencias').textContent = \`Las asistencias \${assist_text.join(', ')} suman un costo anual de \${formatMoney(assists_renov_total)}.\`;
            } else {
                $('textAsistencias').textContent = 'No se incluyeron asistencias opcionales.';
            }

            $('textTotal').textContent = \`El total a pagar por cuota, incluyendo el plan y las asistencias, ser√° de \${formatMoney(cuota_renov)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, cuota_renov,
                assists_renov_total,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();

            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='2'; 
                window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0'; 
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; 
                const textsArea = $('textsArea'); textsArea.innerHTML = '';
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n (RENOVACI√ìN):\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual: \${formatMoney(s.total_renov)}\\nCuota por mes: \${formatMoney(s.cuota_renov)}\\n\`;
                
                let assist_copy_text = [];
                const a = s.assists;
                if (a.bici > 0) assist_copy_text.push(\`Bicicleta x\${a.bici}\`);
                if (a.mascota > 0) assist_copy_text.push(\`Mascota x\${a.mascota}\`);
                if (a.repat > 0) assist_copy_text.push(\`Repatriaci√≥n x\${a.repat}\`);
                if (a.salud > 0) assist_copy_text.push(\`Salud x\${a.salud}\`);
                if (a.seguro > 0) assist_copy_text.push(\`Seguro x\${a.seguro}\`); 
            
                if(s.assists_renov_total > 0) {
                    txt += \`Asistencias Opcionales: \${assist_copy_text.join(', ')}. Costo anual: \${formatMoney(s.assists_renov_total)}\\n\`;
                } else {
                    txt += \`Asistencias Opcionales: Ninguna.\\n\`;
                }
                
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate(); 
        }
        window.initUI();
        `;
        function loadPAP_Candelaria() {
            loadLiquidador(PAP_Candelaria_HTML, 'liquidador-pap-candelaria', PAP_Candelaria_Script, 'Liquidador PAP ‚Äî La Candelaria', 'nav-pap-candelaria');
        }

       // 4. PAP Los Olivos
        const PAP_Olivos_HTML = `
            <h1>Liquidador PAP ‚Äî Los Olivos (Planes y Asistencias)</h1>
            <div class="card">
                <div class="small muted">Datos base del plan</div>
                <div class="row" style="margin-top:6px; margin-bottom: 15px;">
                    <div><label>Selecciona el Plan PAP</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div class="row" style="margin-top:8px">
                    <div class="input-group"><label>Bicicleta (cant.)</label><input id="as_bici" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Mascota (cant.)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/></div>
                    <div class="input-group"><label>Repatriaci√≥n (cant.)</label><input id="as_repat" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Salud (cant.)</label><input id="as_salud" type="number" min="0" max="10" value="0"/></div>
                    <div class="input-group"><label>Seguro (cant.)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/></div>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo (Tarifa de Renovaci√≥n)</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textAsistencias" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const PAP_Olivos_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"UNO INTEGRAL", cupos:1, cuotasPermitidas:[1,2,4],
                        values: {
                            "1": { annual_no_discount:73850 },
                            "2": { annual_no_discount:84200 },
                            "4": { annual_no_discount:84200 },
                        }
                    },
                    "2": { name:"UNIDOS INTEGRAL", cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:255600 },
                            "2": { annual_no_discount:317000 },
                            "4": { annual_no_discount:317000 },
                            "6": { annual_no_discount:317000 },
                            "8": { annual_no_discount:317000 },
                            "10":{ annual_no_discount:317000 }
                        }
                    },
                    "3": { name:"INTEGRAL DIEZ", cupos:10, cuotasPermitidas:[1,2,3,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:312600 },
                            "2": { annual_no_discount:366300 },
                            "3": { annual_no_discount:366300 },
                            "4": { annual_no_discount:366300 },
                            "6": { annual_no_discount:366300 },
                            "8": { annual_no_discount:366300 },
                            "10":{ annual_no_discount:366300 }
                        }
                    },
                },
                mayores: {
                    "1": { annual_no_discount:163200, annual_with_discount:149600 },
                    "2": { annual_no_discount:188840, annual_with_discount:173103 },
                    "10":{ annual_no_discount:188840, annual_with_discount:173103 }
                },
                adicionales: {
                    adulto: { label:"Adulto (18-69)", values: { "1": { annual_no_discount:73850 } }},
                    menor: { label:"Menor (<18)", values: { "1": { annual_no_discount:51950 } }}
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO: SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de PAP_Olivos (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, parseInt($('as_seguro').value||0,10)); 
            
            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;

            function getAdicionalValue(type, qty){
                if(qty<=0) return {label:'', anual_renov:0};
                let vals = window.data.assists[type].values[String(cuotas)] || window.data.assists[type].values["1"];
                let label = \`\${window.data.assists[type].label}\`;
                // PAP no tiene descuento de primer a√±o, solo tarifa de renovaci√≥n
                const anual_renov = (type === 'seguro' ? window.data.assists.seguro.values[String(cuotas)].annual_no_discount : vals.annual_no_discount) * qty; 
                return {label, anual_renov};
            }

            const as_b = getAdicionalValue('bici', qty_bici);
            const as_m = getAdicionalValue('mascota', qty_masc);
            const as_r = getAdicionalValue('repatriacion', qty_rep);
            const as_s = getAdicionalValue('salud', qty_sal);
            const as_se = getAdicionalValue('seguro', qty_seg); 

            const final_plan_cost_renov = plan_anual_renov;
            const table_plan_row_renov = plan_anual_renov;

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;

            const total_renov = final_plan_cost_renov + assists_renov_total;

            const cuota_renov = total_renov / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            
            function addRow(label, valRenov, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
                tbody.appendChild(tr);
            }

            $('resultTable').querySelector('thead tr').innerHTML = '<th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th>';
            const planLabel = \`\${window.data.plans[planId].name} (Plan Base)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_renov / (cuotas>0?cuotas:1));

            if(qty_bici>0) addRow(\`Asistencia \${as_b.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_renov/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`Asistencia \${as_m.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_renov/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`Asistencia \${as_r.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_renov/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`Asistencia \${as_s.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_renov/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`Asistencia \${as_se.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_renov/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total de Renovaci√≥n</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(cuota_renov)}</th>\`;
            foot.appendChild(trT);

            $('textsArea').innerHTML = '';
            const divPlan = document.createElement('div'); divPlan.id = 'textPlan'; $('textsArea').appendChild(divPlan);
            const divAsist = document.createElement('div'); divAsist.id = 'textAsistencias'; divAsist.style.marginTop = '6px'; $('textsArea').appendChild(divAsist);
            const divTotal = document.createElement('div'); divTotal.id = 'textTotal'; divTotal.style.marginTop = '6px'; $('textsArea').appendChild(divTotal);

            $('textPlan').textContent = \`Estimado Cliente, el plan \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor base anual de \${formatMoney(plan_anual_renov)} para la renovaci√≥n.\`;
            
            let assist_text = [];
            if (qty_bici > 0) assist_text.push(\`\${qty_bici} Bicicleta\`);
            if (qty_masc > 0) assist_text.push(\`\${qty_masc} Mascota\`);
            if (qty_rep > 0) assist_text.push(\`\${qty_rep} Repatriaci√≥n\`);
            if (qty_sal > 0) assist_text.push(\`\${qty_sal} Salud\`);
            if (qty_seg > 0) assist_text.push(\`\${qty_seg} Seguro\`); 

            if(assists_renov_total > 0) {
                $('textAsistencias').textContent = \`Las asistencias \${assist_text.join(', ')} suman un costo anual de \${formatMoney(assists_renov_total)}.\`;
            } else {
                $('textAsistencias').textContent = 'No se incluyeron asistencias opcionales.';
            }

            $('textTotal').textContent = \`El total a pagar por cuota, incluyendo el plan y las asistencias, ser√° de \${formatMoney(cuota_renov)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, cuota_renov,
                assists_renov_total,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();

            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='3'; 
                window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0'; 
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; 
                const textsArea = $('textsArea'); textsArea.innerHTML = '';
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n (RENOVACI√ìN):\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual: \${formatMoney(s.total_renov)}\\nCuota por mes: \${formatMoney(s.cuota_renov)}\\n\`;
                
                let assist_copy_text = [];
                const a = s.assists;
                if (a.bici > 0) assist_copy_text.push(\`Bicicleta x\${a.bici}\`);
                if (a.mascota > 0) assist_copy_text.push(\`Mascota x\${a.mascota}\`);
                if (a.repat > 0) assist_copy_text.push(\`Repatriaci√≥n x\${a.repat}\`);
                if (a.salud > 0) assist_copy_text.push(\`Salud x\${a.salud}\`);
                if (a.seguro > 0) assist_copy_text.push(\`Seguro x\${a.seguro}\`); 
            
                if(s.assists_renov_total > 0) {
                    txt += \`Asistencias Opcionales: \${assist_copy_text.join(', ')}. Costo anual: \${formatMoney(s.assists_renov_total)}\\n\`;
                } else {
                    txt += \`Asistencias Opcionales: Ninguna.\\n\`;
                }
                
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate(); 
        }
        window.initUI();
        `;
        function loadPAP_Olivos() {
            loadLiquidador(PAP_Olivos_HTML, 'liquidador-pap-olivos', PAP_Olivos_Script, 'Liquidador PAP ‚Äî Los Olivos', 'nav-pap-olivos');
        }

       // 5. UXS La Candelaria
        const UXS_Candelaria_HTML = `
            <h1>Liquidador UXS ‚Äî La Candelaria (Asistencias/Adiciones)</h1>
            <div class="card">
                <div class="small muted">Datos base del plan y adicionales de persona</div>
                <div class="row" style="margin-top:6px; margin-bottom: 15px;">
                    <div><label>Selecciona el Plan UXS</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                </div>
                <div class="row">
                    <div class="input-group"><label>Adultos mayores (&gt;65)</label><input id="numMayores" type="number" min="0" max="9" value="0" /></div>
                    <div class="input-group"><label>Adultos (25-64 a√±os)</label><input id="numAdultos" type="number" min="0" max="9" value="0" /></div>
                    <div class="input-group"><label>Menores (&lt;25 a√±os)</label><input id="numMenores" type="number" min="0" max="9" value="0" /></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div class="row" style="margin-top:8px">
                    <div class="input-group"><label>Bicicleta (cant.)</label><input id="as_bici" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Mascota (cant.)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/></div>
                    <div class="input-group"><label>Repatriaci√≥n (cant.)</label><input id="as_repat" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Salud (cant.)</label><input id="as_salud" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Seguro (cant.)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/></div>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo (Tarifa de Renovaci√≥n)</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textMayores" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const UXS_Candelaria_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"CANDELARIA", cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:385000, annual_with_discount:385000 },
                            "2": { annual_no_discount:444000, annual_with_discount:444000 },
                            "4": { annual_no_discount:444000, annual_with_discount:444000 },
                            "6": { annual_no_discount:444000, annual_with_discount:444000 },
                            "8": { annual_no_discount:444000, annual_with_discount:444000 },
                            "10":{ annual_no_discount:444000, annual_with_discount:444000 }
                        }
                    },
                    "2": { name:"CANDELARIA UNIFAMILIAR", cupos:7 , cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:412300, annual_with_discount:412300 },
                            "2": { annual_no_discount:475600, annual_with_discount:475600 },
                            "4": { annual_no_discount:475600, annual_with_discount:475600 },
                            "6": { annual_no_discount:475600, annual_with_discount:475600 },
                            "8": { annual_no_discount:475600, annual_with_discount:475600 },
                            "10":{ annual_no_discount:475600, annual_with_discount:475600 }
                        }
                    },
                    "3": { name:"CANDELARIA DIEZ", cupos:10, cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:439600, annual_with_discount:261400 },
                            "2": { annual_no_discount:506400, annual_with_discount:506400 },
                            "4": { annual_no_discount:506400, annual_with_discount:506400 },
                            "6": { annual_no_discount:506400, annual_with_discount:506400 },
                            "8": { annual_no_discount:506400, annual_with_discount:506400 },
                            "10":{ annual_no_discount:506400, annual_with_discount:506400 }
                        }
                    },
                },
                mayores: {
                    "1": { annual_no_discount:199000, annual_with_discount:199000 },
                    "2": { annual_no_discount:229800, annual_with_discount:229800 },
                    "3": { annual_no_discount:229800, annual_with_discount:229800 },
                    "4": { annual_no_discount:229800, annual_with_discount:229800 },
                    "6": { annual_no_discount:229800, annual_with_discount:229800 },
                    "8": { annual_no_discount:229800, annual_with_discount:229800 },
                    "10":{ annual_no_discount:229800, annual_with_discount:229800 }
                },
                adicionales: {
                    adulto: { label:"Adulto (30-64)", values: {
                        "1": { annual_no_discount:132700 },
                        "2": { annual_no_discount:153600 },
                        "3": { annual_no_discount:153600 },
                        "4": { annual_no_discount:153600 },
                        "6": { annual_no_discount:153600 },
                        "8": { annual_no_discount:153600 },
                        "10":{ annual_no_discount:153600 }
                    }},
                    menor: { label:"Menor (<29)", values: {
                        "1": { annual_no_discount:66400 },
                        "2": { annual_no_discount:76800 },
                        "3": { annual_no_discount:76800 },
                        "4": { annual_no_discount:76800 },
                        "6": { annual_no_discount:76800 },
                        "8": { annual_no_discount:76800 },
                        "10":{ annual_no_discount:76800 }
                    }}
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO: SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de UXS_Candelaria (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const nMay = Math.max(0, Math.min(10, parseInt($('numMayores').value||0,10)));
            const nAdult = Math.max(0, Math.min(10, parseInt($('numAdultos').value||0,10)));
            const nMenor = Math.max(0, Math.min(10, parseInt($('numMenores').value||0,10)));
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, parseInt($('as_seguro').value||0,10)); 
            
            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;
            
            function getAdicionalValue(type, qty, isMayor = false){
                if(qty<=0) return {label:'', anual_renov:0, qty:0};
                let vals;
                let label;

                if(isMayor){
                    vals = window.data.mayores[String(cuotas)] || window.data.mayores["2"];
                    label = \`Adultos mayores (+65 a√±os)\`;
                    const anual_renov = vals.annual_no_discount * qty;
                    return {label, anual_renov, qty:qty};
                } else if(window.data.adicionales[type]){
                    vals = window.data.adicionales[type].values[String(cuotas)] || window.data.adicionales[type].values["1"];
                    label = \`\${window.data.adicionales[type].label}\`;
                    const anual_renov = vals.annual_no_discount * qty;
                    return {label, anual_renov, qty:qty};
                } else if (window.data.assists[type]){
                    vals = window.data.assists[type].values[String(cuotas)] || window.data.assists[type].values["1"];
                    label = \`\${window.data.assists[type].label}\`;
                    const anual_renov = vals.annual_no_discount * qty;
                    return {label, anual_renov, qty:qty};
                }
                return {label:'', anual_renov:0, qty:0};
            }

            const as_may = getAdicionalValue('mayores', nMay, true);
            const as_adult = getAdicionalValue('adulto', nAdult);
            const as_minor = getAdicionalValue('menor', nMenor);
            const as_b = getAdicionalValue('bici', qty_bici);
            const as_m = getAdicionalValue('mascota', qty_masc);
            const as_r = getAdicionalValue('repatriacion', qty_rep);
            const as_s = getAdicionalValue('salud', qty_sal);
            const as_se = getAdicionalValue('seguro', qty_seg); 

            const adicionales_personas_total_renov = as_may.anual_renov + as_adult.anual_renov + as_minor.anual_renov;
            const final_plan_cost_renov = plan_anual_renov + adicionales_personas_total_renov;
            const table_plan_row_renov = plan_anual_renov;

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;
            
            const total_renov = final_plan_cost_renov + assists_renov_total;
            const cuota_renov = total_renov / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            
            function addRow(label, valRenov, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
                tbody.appendChild(tr);
            }

            $('resultTable').querySelector('thead tr').innerHTML = '<th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th>';
            const planLabel = \`\${window.data.plans[planId].name} (Plan Base)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_renov / (cuotas>0?cuotas:1));

            const adicionales_rows = [];
            if(nMay>0) adicionales_rows.push(as_may);
            if(nAdult>0) adicionales_rows.push(as_adult);
            if(nMenor>0) adicionales_rows.push(as_minor);

            adicionales_rows.forEach(a => {
                const detalleCuota = a.anual_renov / (cuotas>0?cuotas:1);
                addRow(\`Adicional \${a.label} x \${a.qty}\`, a.anual_renov, detalleCuota); 
            });

            if(qty_bici>0) addRow(\`Asistencia \${as_b.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_renov/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`Asistencia \${as_m.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_renov/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`Asistencia \${as_r.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_renov/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`Asistencia \${as_s.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_renov/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`Asistencia \${as_se.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_renov/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total de Renovaci√≥n</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(cuota_renov)}</th>\`;
            foot.appendChild(trT);

            $('textsArea').innerHTML = '';
            const divPlan = document.createElement('div'); divPlan.id = 'textPlan'; $('textsArea').appendChild(divPlan);
            const divAdic = document.createElement('div'); divAdic.id = 'textAdicionales'; divAdic.style.marginTop = '6px'; $('textsArea').appendChild(divAdic);
            const divAsist = document.createElement('div'); divAsist.id = 'textAsistencias'; divAsist.style.marginTop = '6px'; $('textsArea').appendChild(divAsist);
            const divTotal = document.createElement('div'); divTotal.id = 'textTotal'; divTotal.style.marginTop = '6px'; $('textsArea').appendChild(divTotal);

            $('textPlan').textContent = \`Estimado Cliente, el plan UXS \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor total anual de \${formatMoney(total_renov)} sin tiempo de carencia.\`;
            
            let adic_text = [];
            if (nMay > 0) adic_text.push(\`\${nMay} adulto(s) mayor(es) (+65 a√±os)\`);
            if (nAdult > 0) adic_text.push(\`\${nAdult} adulto(s) (30-64 a√±os)\`);
            if (nMenor > 0) adic_text.push(\`\${nMenor} menor(es) (<29 a√±os)\`);

            if(adicionales_personas_total_renov > 0){
                $('textAdicionales').textContent = \`Su plan incluye \${adic_text.join(', ')} adicionales, con un costo total anual de \${formatMoney(adicionales_personas_total_renov)}.\`;
            } else {
                $('textAdicionales').textContent = 'No se incluyeron adicionales de persona en esta cotizaci√≥n.';
            }

            let assist_text = [];
            if (qty_bici > 0) assist_text.push(\`\${qty_bici} Bicicleta\`);
            if (qty_masc > 0) assist_text.push(\`\${qty_masc} Mascota\`);
            if (qty_rep > 0) assist_text.push(\`\${qty_rep} Repatriaci√≥n\`);
            if (qty_sal > 0) assist_text.push(\`\${qty_sal} Salud\`);
            if (qty_seg > 0) assist_text.push(\`\${qty_seg} Seguro\`); 

            if(assists_renov_total > 0) {
                $('textAsistencias').textContent = \`Las asistencias \${assist_text.join(', ')} suman un costo anual de \${formatMoney(assists_renov_total)}.\`;
            } else {
                $('textAsistencias').textContent = 'No se incluyeron asistencias opcionales.';
            }

            $('textTotal').textContent = \`El total a pagar por cuota, incluyendo el plan, adicionales y asistencias, ser√° de \${formatMoney(cuota_renov)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, cuota_renov,
                nMay, nAdult, nMenor,
                adicionales_personas_total_renov,
                assists_renov_total,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();

            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='3'; 
                window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('numMayores').value='0'; 
                $('numAdultos').value='0'; 
                $('numMenores').value='0';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0'; 
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; 
                const textsArea = $('textsArea'); textsArea.innerHTML = ''; 
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n (RENOVACI√ìN):\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual: \${formatMoney(s.total_renov)}\\nCuota por mes: \${formatMoney(s.cuota_renov)}\\n\`;
                
                let adic_copy_text = [];
                if (s.nMay > 0) adic_copy_text.push(\`\${s.nMay} Mayor (+70)\`);
                if (s.nAdult > 0) adic_copy_text.push(\`\${s.nAdult} Adulto (18-69)\`);
                if (s.nMenor > 0) adic_copy_text.push(\`\${s.nMenor} Menor (<18)\`);
            
                if(s.adicionales_personas_total_renov > 0) {
                    txt += \`Adicionales de persona: \${adic_copy_text.join(', ')}. Costo anual: \${formatMoney(s.adicionales_personas_total_renov)}\\n\`;
                }
                
                let assist_copy_text = [];
                const a = s.assists;
                if (a.bici > 0) assist_copy_text.push(\`Bicicleta x\${a.bici}\`);
                if (a.mascota > 0) assist_copy_text.push(\`Mascota x\${a.mascota}\`);
                if (a.repat > 0) assist_copy_text.push(\`Repatriaci√≥n x\${a.repat}\`);
                if (a.salud > 0) assist_copy_text.push(\`Salud x\${a.salud}\`);
                if (a.seguro > 0) assist_copy_text.push(\`Seguro x\${a.seguro}\`); 
            
                if(s.assists_renov_total > 0) {
                    txt += \`Asistencias Opcionales: \${assist_copy_text.join(', ')}. Costo anual: \${formatMoney(s.assists_renov_total)}\\n\`;
                }
                
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate(); 
        }
        window.initUI();
        `;
        function loadUXS_Candelaria() {
            loadLiquidador(UXS_Candelaria_HTML, 'liquidador-uxs-candelaria', UXS_Candelaria_Script, 'Liquidador UXS ‚Äî La Candelaria', 'nav-uxs-candelaria');
        }

        // 6. UXS Los Olivos
        const UXS_Olivos_HTML = `
            <h1>Liquidador UXS ‚Äî Los Olivos (Asistencias/Adiciones)</h1>
            <div class="card">
                <div class="small muted">Datos base del plan y adicionales de persona</div>
                <div class="row" style="margin-top:6px; margin-bottom: 15px;">
                    <div><label>Selecciona el Plan UXS</label><select id="planSelect"></select></div>
                    <div><label>N√∫mero de cuotas</label><select id="cuotasSelect"></select></div>
                </div>
                <div class="row">
                    <div class="input-group"><label>Adultos mayores (&gt;65)</label><input id="numMayores" type="number" min="0" max="9" value="0" /></div>
                    <div class="input-group"><label>Adultos (25-64 a√±os)</label><input id="numAdultos" type="number" min="0" max="9" value="0" /></div>
                    <div class="input-group"><label>Menores (&lt;25 a√±os)</label><input id="numMenores" type="number" min="0" max="9" value="0" /></div>
                </div>
            </div>
            <div class="card">
                <div class="small muted">Asistencias opcionales (indica cantidad por asistencia)</div>
                <div class="row" style="margin-top:8px">
                    <div class="input-group"><label>Bicicleta (cant.)</label><input id="as_bici" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Mascota (cant.)</label><input id="as_mascota" type="number" min="0" max="3" value="0"/></div>
                    <div class="input-group"><label>Repatriaci√≥n (cant.)</label><input id="as_repat" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Salud (cant.)</label><input id="as_salud" type="number" min="0" max="9" value="0"/></div>
                    <div class="input-group"><label>Seguro (cant.)</label><input id="as_seguro" type="number" min="0" max="1" value="0"/></div>
                </div>
            </div>
            <div style="margin-bottom:12px">
                <button class="btn" id="btnCalc">Calcular</button>
                <button class="btn" id="btnCopy">Copiar resumen</button>
                <button class="btn" id="btnReset">Nuevo c√°lculo</button>
                <span id="warn" class="warning" style="margin-left:10px"></span>
            </div>
            <div class="card">
                <div style="font-weight:700;margin-bottom:8px">Resultados del c√°lculo (Tarifa de Renovaci√≥n)</div>
                <table id="resultTable" aria-live="polite">
                    <thead><tr><th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th></tr></thead>
                    <tbody id="resultBody"></tbody>
                    <tfoot id="resultFoot"></tfoot>
                </table>
                <div class="summary" id="textsArea">
                    <div id="textPlan"></div>
                    <div id="textMayores" style="margin-top:6px"></div>
                    <div id="textTotal" style="margin-top:6px"></div>
                </div>
            </div>
        `;
        const UXS_Olivos_Script = `
        window.data = (function(){
            return {
                plans: {
                    "1": { name:"INTEGRAL UNIPERSONAL", cupos:1, cuotasPermitidas:[1,2,4],
                        values: {
                            "1": { annual_no_discount:110550, annual_with_discount:110550 },
                            "2": { annual_no_discount:127600, annual_with_discount:127600 },
                            "4": { annual_no_discount:127600, annual_with_discount:127600 }
                        }
                    },
                    "2": { name:"INTEGRAL", cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:192500, annual_with_discount:192500 },
                            "2": { annual_no_discount:222400, annual_with_discount:222400 },
                            "4": { annual_no_discount:222400, annual_with_discount:222400 },
                            "6": { annual_no_discount:222400, annual_with_discount:222400 },
                            "8": { annual_no_discount:222400, annual_with_discount:222400 },
                            "10":{ annual_no_discount:222400, annual_with_discount:222400 }
                        }
                    },
                    "3": { name:"INTEGRAL UNIFAMILIAR", cupos:7, cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:261400, annual_with_discount:261400 },
                            "2": { annual_no_discount:302000, annual_with_discount:302000 },
                            "4": { annual_no_discount:302000, annual_with_discount:302000 },
                            "6": { annual_no_discount:302000, annual_with_discount:302000 },
                            "8": { annual_no_discount:302000, annual_with_discount:302000 },
                            "10":{ annual_no_discount:302000, annual_with_discount:302000 }
                        }
                    },
                    "4": { name:"INTEGRAL DIEZ", cupos:10, cuotasPermitidas:[1,2,4,6,8,10],
                        values: {
                            "1": { annual_no_discount:288800, annual_with_discount:288800 },
                            "2": { annual_no_discount:333600, annual_with_discount:333600 },
                            "4": { annual_no_discount:333600, annual_with_discount:333600 },
                            "6": { annual_no_discount:333600, annual_with_discount:333600 },
                            "8": { annual_no_discount:333600, annual_with_discount:333600 },
                            "10":{ annual_no_discount:333600, annual_with_discount:333600 }
                        }
                    },
                },
                mayores: {
                    "1": { annual_no_discount:149600, annual_with_discount:149600 },
                    "2": { annual_no_discount:173100, annual_with_discount:173100 },
                    "3": { annual_no_discount:173100, annual_with_discount:173100 },
                    "4": { annual_no_discount:173100, annual_with_discount:173100 },
                    "6": { annual_no_discount:173100, annual_with_discount:173100 },
                    "8": { annual_no_discount:173100, annual_with_discount:173100 },
                    "10":{ annual_no_discount:173100, annual_with_discount:173100 }
                },
                adicionales: {
                    adulto: { label:"Adulto (30-64)", values: {
                        "1": { annual_no_discount:58590 },
                        "2": { annual_no_discount:67800 },
                        "3": { annual_no_discount:67800 },
                        "4": { annual_no_discount:67800 },
                        "6": { annual_no_discount:67800 },
                        "8": { annual_no_discount:67800 },
                        "10":{ annual_no_discount:67800 }
                    }},
                    menor: { label:"Menor (<29)", values: {
                        "1": { annual_no_discount:17040 },
                        "2": { annual_no_discount:19920 },
                        "3": { annual_no_discount:19920 },
                        "4": { annual_no_discount:19920 },
                        "6": { annual_no_discount:19920 },
                        "8": { annual_no_discount:19920 },
                        "10":{ annual_no_discount:19920 }
                    }}
                },
                assists: {
                    bici: { label:"Bicicleta", values: {
                        "1": { annual_no_discount:18620, annual_with_discount:17068 },
                        "2": { annual_no_discount:21600, annual_with_discount:19800 },
                        "3": { annual_no_discount:21600, annual_with_discount:19800 },
                        "4": { annual_no_discount:21600, annual_with_discount:19800 },
                        "6": { annual_no_discount:21600, annual_with_discount:19800 },
                        "8": { annual_no_discount:21600, annual_with_discount:19800 },
                        "10":{ annual_no_discount:21600, annual_with_discount:19800 }
                    }},
                    mascota: { label:"Mascota", values: {
                        "1": { annual_no_discount:78000, annual_with_discount:71500 },
                        "2": { annual_no_discount:87000, annual_with_discount:79750 },
                        "3": { annual_no_discount:87000, annual_with_discount:79750 },
                        "4": { annual_no_discount:87000, annual_with_discount:79750 },
                        "6": { annual_no_discount:87000, annual_with_discount:79750 },
                        "8": { annual_no_discount:87000, annual_with_discount:79750 },
                        "10":{ annual_no_discount:87000, annual_with_discount:79750 }
                    }},
                    repatriacion: { label:"Repatriaci√≥n", values: {
                        "1": { annual_no_discount:13600, annual_with_discount:12467 },
                        "2": { annual_no_discount:16200, annual_with_discount:14850 },
                        "3": { annual_no_discount:16200, annual_with_discount:14850 },
                        "4": { annual_no_discount:16200, annual_with_discount:14850 },
                        "6": { annual_no_discount:16200, annual_with_discount:14850 },
                        "8": { annual_no_discount:16200, annual_with_discount:14850 },
                        "10":{ annual_no_discount:16200, annual_with_discount:14850 }
                    }},
                    salud: { label:"Salud", values: {
                        "1": { annual_no_discount:23700, annual_with_discount:21725 },
                        "2": { annual_no_discount:27900, annual_with_discount:25575 },
                        "3": { annual_no_discount:27900, annual_with_discount:25575 },
                        "4": { annual_no_discount:27900, annual_with_discount:25575 },
                        "6": { annual_no_discount:27900, annual_with_discount:25575 },
                        "8": { annual_no_discount:27900, annual_with_discount:25575 },
                        "10":{ annual_no_discount:27900, annual_with_discount:25575 }
                    }},
                    // **NUEVO CAMPO: SEGURO**
                    seguro: { label:"Seguro", values: {
                        "1": { annual_no_discount:23400, annual_with_discount:23400 },
                        "2": { annual_no_discount:23400, annual_with_discount:23400 },
                        "3": { annual_no_discount:23400, annual_with_discount:23400 },
                        "4": { annual_no_discount:23400, annual_with_discount:23400 },
                        "6": { annual_no_discount:23400, annual_with_discount:23400 },
                        "8": { annual_no_discount:23400, annual_with_discount:23400 },
                        "10":{ annual_no_discount:23400, annual_with_discount:23400 }
                    }}
                }
            };
        })();

        // El resto del script de UXS_Olivos (rebuildCuotas, calculate, listeners)
        window.rebuildCuotas = function(){
            const plan = $('planSelect');
            const cuotasSel = $('cuotasSelect');
            if(!plan || !cuotasSel) return;
            const planId = plan.value;
            cuotasSel.innerHTML = '';
            const allowed = window.data.plans[planId].cuotasPermitidas;
            allowed.forEach(q=>{
                const opt = document.createElement('option');
                opt.value = q;
                opt.text = q;
                cuotasSel.appendChild(opt);
            });
        }

        window.calculate = function(){
            const warn = $('warn'); warn.textContent='';
            const planId = $('planSelect').value;
            const cuotas = parseInt($('cuotasSelect').value,10);
            const nMay = Math.max(0, Math.min(10, parseInt($('numMayores').value||0,10)));
            const nAdult = Math.max(0, Math.min(10, parseInt($('numAdultos').value||0,10)));
            const nMenor = Math.max(0, Math.min(10, parseInt($('numMenores').value||0,10)));
            const qty_bici = Math.max(0, parseInt($('as_bici').value||0,10));
            const qty_masc = Math.max(0, parseInt($('as_mascota').value||0,10));
            const qty_rep = Math.max(0, parseInt($('as_repat').value||0,10));
            const qty_sal = Math.max(0, parseInt($('as_salud').value||0,10));
            const qty_seg = Math.max(0, parseInt($('as_seguro').value||0,10)); 

            const plan = window.data.plans[planId];
            if(!plan) { warn.textContent='Plan inv√°lido'; return; }
            if(!plan.cuotasPermitidas.includes(cuotas)){
                warn.textContent = \`Cuotas no permitidas para \${plan.name}. Permite: \${plan.cuotasPermitidas.join(', ')}\`;
                return;
            }

            const planVals = plan.values[String(cuotas)];
            if(!planVals){ warn.textContent='No hay tarifa definida para esa combinaci√≥n.'; return; }

            const plan_anual_renov = planVals.annual_no_discount;
            
            function getAdicionalValue(type, qty, isMayor = false){
                if(qty<=0) return {label:'', anual_renov:0, qty:0};
                let vals;
                let label;

                if(isMayor){
                    vals = window.data.mayores[String(cuotas)] || window.data.mayores["2"];
                    label = \`Adultos mayores (+65 a√±os)\`;
                    const anual_renov = vals.annual_no_discount * qty;
                    return {label, anual_renov, qty:qty};
                } else if(window.data.adicionales[type]){
                    vals = window.data.adicionales[type].values[String(cuotas)] || window.data.adicionales[type].values["1"];
                    label = \`\${window.data.adicionales[type].label}\`;
                    const anual_renov = vals.annual_no_discount * qty;
                    return {label, anual_renov, qty:qty};
                } else if (window.data.assists[type]){
                    vals = window.data.assists[type].values[String(cuotas)] || window.data.assists[type].values["1"];
                    label = \`\${window.data.assists[type].label}\`;
                    // Se usa la tarifa no descontada para UXS
                    const anual_renov = vals.annual_no_discount * qty; 
                    return {label, anual_renov, qty:qty};
                }
                return {label:'', anual_renov:0, qty:0};
            }

            const as_may = getAdicionalValue('mayores', nMay, true);
            const as_adult = getAdicionalValue('adulto', nAdult);
            const as_minor = getAdicionalValue('menor', nMenor);
            const as_b = getAdicionalValue('bici', qty_bici);
            const as_m = getAdicionalValue('mascota', qty_masc);
            const as_r = getAdicionalValue('repatriacion', qty_rep);
            const as_s = getAdicionalValue('salud', qty_sal);
            const as_se = getAdicionalValue('seguro', qty_seg); 

            const adicionales_personas_total_renov = as_may.anual_renov + as_adult.anual_renov + as_minor.anual_renov;
            const final_plan_cost_renov = plan_anual_renov + adicionales_personas_total_renov;
            const table_plan_row_renov = plan_anual_renov;

            const assists_renov_total = as_b.anual_renov + as_m.anual_renov + as_r.anual_renov + as_s.anual_renov + as_se.anual_renov;
            
            const total_renov = final_plan_cost_renov + assists_renov_total;
            const cuota_renov = total_renov / (cuotas>0?cuotas:1);

            const tbody = $('resultBody'); tbody.innerHTML='';
            
            function addRow(label, valRenov, cuota){
                const tr = document.createElement('tr');
                const td1 = document.createElement('td'); td1.textContent = label;
                const td2 = document.createElement('td'); td2.className='right'; td2.textContent = formatMoney(valRenov);
                const td3 = document.createElement('td'); td3.className='right'; td3.textContent = cuota!==undefined?formatMoney(cuota):'-';
                tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
                tbody.appendChild(tr);
            }

            $('resultTable').querySelector('thead tr').innerHTML = '<th>Concepto</th><th class="right">Anual (Renovaci√≥n)</th><th class="right">Cuota</th>';
            const planLabel = \`\${window.data.plans[planId].name} (Plan Base)\`;
            addRow(planLabel, table_plan_row_renov, table_plan_row_renov / (cuotas>0?cuotas:1));

            const adicionales_rows = [];
            if(nMay>0) adicionales_rows.push(as_may);
            if(nAdult>0) adicionales_rows.push(as_adult);
            if(nMenor>0) adicionales_rows.push(as_minor);

            adicionales_rows.forEach(a => {
                const detalleCuota = a.anual_renov / (cuotas>0?cuotas:1);
                addRow(\`Adicional \${a.label} x \${a.qty}\`, a.anual_renov, detalleCuota); 
            });

            if(qty_bici>0) addRow(\`Asistencia \${as_b.label} x \${qty_bici}\`, as_b.anual_renov, as_b.anual_renov/(cuotas>0?cuotas:1));
            if(qty_masc>0) addRow(\`Asistencia \${as_m.label} x \${qty_masc}\`, as_m.anual_renov, as_m.anual_renov/(cuotas>0?cuotas:1));
            if(qty_rep>0) addRow(\`Asistencia \${as_r.label} x \${qty_rep}\`, as_r.anual_renov, as_r.anual_renov/(cuotas>0?cuotas:1));
            if(qty_sal>0) addRow(\`Asistencia \${as_s.label} x \${qty_sal}\`, as_s.anual_renov, as_s.anual_renov/(cuotas>0?cuotas:1));
            if(qty_seg>0) addRow(\`Asistencia \${as_se.label} x \${qty_seg}\`, as_se.anual_renov, as_se.anual_renov/(cuotas>0?cuotas:1)); 

            const foot = $('resultFoot'); foot.innerHTML = '';
            const trT = document.createElement('tr');
            trT.innerHTML = \`<th>Total de Renovaci√≥n</th><th class="right">\${formatMoney(total_renov)}</th><th class="right">\${formatMoney(cuota_renov)}</th>\`;
            foot.appendChild(trT);

            $('textsArea').innerHTML = '';
            const divPlan = document.createElement('div'); divPlan.id = 'textPlan'; $('textsArea').appendChild(divPlan);
            const divAdic = document.createElement('div'); divAdic.id = 'textAdicionales'; $('textsArea').appendChild(divAdic);
            const divAsist = document.createElement('div'); divAsist.id = 'textAsistencias'; $('textsArea').appendChild(divAsist);
            const divTotal = document.createElement('div'); divTotal.id = 'textTotal'; $('textsArea').appendChild(divTotal);

            $('textPlan').textContent = \`Estimado Cliente, el plan UXS \${window.data.plans[planId].name} en \${cuotas} cuota(s) tiene un valor total anual de \${formatMoney(total_renov)} sin tiempo de carencia.\`;
            
            let adic_text = [];
            if (nMay > 0) adic_text.push(\`\${nMay} adulto(s) mayor(es) (+65 a√±os)\`);
            if (nAdult > 0) adic_text.push(\`\${nAdult} adulto(s) (30-64 a√±os)\`);
            if (nMenor > 0) adic_text.push(\`\${nMenor} menor(es) (<29 a√±os)\`);

            if(adicionales_personas_total_renov > 0){
                $('textAdicionales').textContent = \`Su plan incluye \${adic_text.join(', ')} adicionales, con un costo total anual de \${formatMoney(adicionales_personas_total_renov)}.\`;
            } else {
                $('textAdicionales').textContent = 'No se incluyeron adicionales de persona en esta cotizaci√≥n.';
            }

            let assist_text = [];
            if (qty_bici > 0) assist_text.push(\`\${qty_bici} Bicicleta\`);
            if (qty_masc > 0) assist_text.push(\`\${qty_masc} Mascota\`);
            if (qty_rep > 0) assist_text.push(\`\${qty_rep} Repatriaci√≥n\`);
            if (qty_sal > 0) assist_text.push(\`\${qty_sal} Salud\`);
            if (qty_seg > 0) assist_text.push(\`\${qty_seg} Seguro\`); 

            if(assists_renov_total > 0) {
                $('textAsistencias').textContent = \`Las asistencias \${assist_text.join(', ')} suman un costo anual de \${formatMoney(assists_renov_total)}.\`;
            } else {
                $('textAsistencias').textContent = 'No se incluyeron asistencias opcionales.';
            }

            $('textTotal').textContent = \`El total a pagar por cuota, incluyendo el plan, adicionales y asistencias, ser√° de \${formatMoney(cuota_renov)} por cuota (\${cuotas} cuotas).\`;

            window._lastSummary = {
                plan: window.data.plans[planId].name,
                cuotas,
                total_renov, cuota_renov,
                nMay, nAdult, nMenor,
                adicionales_personas_total_renov,
                assists_renov_total,
                assists:{bici:qty_bici,mascota:qty_masc,repat:qty_rep,salud:qty_sal,seguro:qty_seg} 
            };
        }

        window.initUI = function(){
            const planSel = $('planSelect');
            if (!planSel) return;
            for(const key of Object.keys(window.data.plans)){
                const p = window.data.plans[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = \`\${p.name} (\${p.cupos} cupo\${p.cupos>1?'s':''})\`;
                planSel.appendChild(opt);
            }
            planSel.addEventListener('change', window.rebuildCuotas);
            window.rebuildCuotas();

            $('btnCalc').addEventListener('click', window.calculate);
            $('btnReset').addEventListener('click', ()=>{
                $('planSelect').value='4'; 
                window.rebuildCuotas();
                $('cuotasSelect').value='10';
                $('numMayores').value='0'; 
                $('numAdultos').value='0'; 
                $('numMenores').value='0';
                $('as_bici').value='0'; $('as_mascota').value='0'; $('as_repat').value='0'; $('as_salud').value='0'; $('as_seguro').value='0'; 
                $('resultBody').innerHTML=''; $('resultFoot').innerHTML=''; 
                const textsArea = $('textsArea'); textsArea.innerHTML = ''; 
                $('warn').textContent='';
            });
            $('btnCopy').addEventListener('click', ()=>{
                const s = window._lastSummary;
                if(!s){ alert('No hay resumen para copiar. Haz un c√°lculo primero.'); return; }
                let txt = \`Resumen cotizaci√≥n (RENOVACI√ìN):\\nPlan: \${s.plan}\\nCuotas: \${s.cuotas}\\nTotal anual: \${formatMoney(s.total_renov)}\\nCuota por mes: \${formatMoney(s.cuota_renov)}\\n\`;
                
                let adic_copy_text = [];
                if (s.nMay > 0) adic_copy_text.push(\`\${s.nMay} Mayor (+70)\`);
                if (s.nAdult > 0) adic_copy_text.push(\`\${s.nAdult} Adulto (18-69)\`);
                if (s.nMenor > 0) adic_copy_text.push(\`\${s.nMenor} Menor (<18)\`);
            
                if(s.adicionales_personas_total_renov > 0) {
                    txt += \`Adicionales de persona: \${adic_copy_text.join(', ')}. Costo anual: \${formatMoney(s.adicionales_personas_total_renov)}\\n\`;
                }
                
                let assist_copy_text = [];
                const a = s.assists;
                if (a.bici > 0) assist_copy_text.push(\`Bicicleta x\${a.bici}\`);
                if (a.mascota > 0) assist_copy_text.push(\`Mascota x\${a.mascota}\`);
                if (a.repat > 0) assist_copy_text.push(\`Repatriaci√≥n x\${a.repat}\`);
                if (a.salud > 0) assist_copy_text.push(\`Salud x\${a.salud}\`);
                if (a.seguro > 0) assist_copy_text.push(\`Seguro x\${a.seguro}\`); 
            
                if(s.assists_renov_total > 0) {
                    txt += \`Asistencias Opcionales: \${assist_copy_text.join(', ')}. Costo anual: \${formatMoney(s.assists_renov_total)}\\n\`;
                }
                
                navigator.clipboard && navigator.clipboard.writeText(txt).then(()=> alert('Resumen copiado'));
            });
            window.calculate(); 
        }
        window.initUI();
        `;
        function loadUXS_Olivos() {
            loadLiquidador(UXS_Olivos_HTML, 'liquidador-uxs-olivos', UXS_Olivos_Script, 'Liquidador UXS ‚Äî Los Olivos', 'nav-uxs-olivos');
        }


        // Iniciar la aplicaci√≥n en la vista de selecci√≥n.
        loadSelector();

    </script>
</body>
</html>
